<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Template for listing pharmacy products -->
    <template id="pharmacy_products_template" name="Pharmacy Products">
        <t t-call="website.layout">
            <div class="container mt-4">
                <div class="row mb-4">
                    <div class="col-md-6">
                        <h1>Kho dược phẩm</h1>
                    </div>
                    <div class="col-md-3">
                        <form action="/pharmacy/products" method="GET" class="input-group">
                            <input type="text" name="search" class="form-control" placeholder="Tìm kiếm thuốc..." t-att-value="search or ''"/>
                            <div class="input-group-append">
                                <button type="submit" class="btn btn-primary">
                                    <i class="fa fa-search"></i>
                                </button>
                            </div>
                        </form>
                    </div>
                    <div class="col-md-3 text-right">
                        <a href="/pharmacy/product/new" class="btn btn-success">
                            <i class="fa fa-plus"></i> Thêm dược phẩm mới
                        </a>
                    </div>
                </div>

                <!-- Display success/error messages -->
                <t t-if="request.params.get('deletion_success')">
                    <div class="alert alert-success alert-dismissible fade show">
                        Dược phẩm đã được xóa thành công.
                        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                            <span aria-hidden="true">&amp;times;</span>
                        </button>
                    </div>
                </t>
                <t t-if="request.params.get('deletion_error')">
                    <div class="alert alert-danger alert-dismissible fade show">
                        Không thể xóa dược phẩm. Vui lòng kiểm tra quyền truy cập hoặc liên kết với các bản ghi khác.
                        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                            <span aria-hidden="true">&amp;times;</span>
                        </button>
                    </div>
                </t>

                <div class="card shadow-sm">
                    <div class="card-header bg-primary text-white">
                        <div class="row">
                            <div class="col-md-2">Mã thuốc</div>
                            <div class="col-md-3">Tên thuốc</div>
                            <div class="col-md-2">Đơn vị</div>
                            <div class="col-md-2">Tồn kho</div>
                            <div class="col-md-1">Giá bán</div>
                            <div class="col-md-2 text-center">Thao tác</div>
                        </div>
                    </div>
                    <div class="card-body p-0">
                        <t t-if="pharmacy_products">
                            <t t-foreach="pharmacy_products" t-as="product">
                                <div class="row p-3 border-bottom" t-att-class="'bg-light' if product_index % 2 == 0 else ''">
                                    <div class="col-md-2" t-esc="product.code"/>
                                    <div class="col-md-3">
                                        <strong t-esc="product.name"/>
                                        <t t-if="product.category">
                                            <small class="d-block text-muted" t-esc="product.category"/>
                                        </t>
                                    </div>
                                    <div class="col-md-2" t-esc="product.uom_id"/>
                                    <div class="col-md-2">
                                        <span t-att-class="'text-danger font-weight-bold' if product.is_quantity else ''" t-esc="product.quantity"/>
                                        <t t-if="product.is_quantity">
                                            <i class="fa fa-exclamation-triangle text-warning ml-1" title="Sắp hết hàng"></i>
                                        </t>
                                    </div>
                                    <div class="col-md-1" t-esc="'{:,.0f}'.format(product.unit_price)"/>
                                    <div class="col-md-2 text-center">
                                        <div class="btn-group btn-group-sm">
                                            <a t-att-href="'/pharmacy/product/%s' % product.id" class="btn btn-info" title="Xem chi tiết">
                                                <i class="fa fa-info-circle"></i>
                                            </a>
                                            <a t-att-href="'/pharmacy/product/%s/edit' % product.id" class="btn btn-primary" title="Chỉnh sửa">
                                                <i class="fa fa-edit"></i>
                                            </a>
                                            <a t-att-href="'/pharmacy/product/%s/delete' % product.id"
                                               class="btn btn-danger"
                                               title="Xóa"
                                               onclick="return confirm('Bạn có chắc chắn muốn xóa dược phẩm này?');">
                                                <i class="fa fa-trash"></i>
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </t>
                        </t>
                        <t t-else="">
                            <div class="alert alert-info m-3">
                                Không có dược phẩm nào được tìm thấy.
                            </div>
                        </t>
                    </div>
                </div>
            </div>
        </t>
    </template>

    <!-- Template for pharmacy product detail -->
    <template id="pharmacy_product_detail_template" name="Pharmacy Product Detail">
        <t t-call="website.layout">
            <div class="container mt-4">
                <div class="row mb-3">
                    <div class="col-md-6">
                        <nav aria-label="breadcrumb">
                            <ol class="breadcrumb">
                                <li class="breadcrumb-item"><a href="/pharmacy">Dashboard</a></li>
                                <li class="breadcrumb-item"><a href="/pharmacy/products">Kho dược phẩm</a></li>
                                <li class="breadcrumb-item active">Chi tiết dược phẩm</li>
                            </ol>
                        </nav>
                    </div>
                    <div class="col-md-6 text-right">
                        <div class="btn-group">
                            <a href="/pharmacy/products" class="btn btn-secondary">
                                <i class="fa fa-arrow-left"></i> Quay lại
                            </a>
                            <a t-att-href="'/pharmacy/product/%s/edit' % product.id" class="btn btn-primary">
                                <i class="fa fa-edit"></i> Chỉnh sửa
                            </a>
                            <a t-att-href="'/pharmacy/product/%s/delete' % product.id"
                               class="btn btn-danger"
                               onclick="return confirm('Bạn có chắc chắn muốn xóa dược phẩm này?');">
                                <i class="fa fa-trash"></i> Xóa
                            </a>
                        </div>
                    </div>
                </div>

                <div class="card shadow">
                    <div class="card-header bg-primary text-white">
                        <h3 class="m-0">Chi tiết dược phẩm</h3>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <strong>Mã thuốc:</strong>
                                    <span class="ml-2" t-esc="product.code"/>
                                </div>
                                <div class="mb-3">
                                    <strong>Tên thuốc:</strong>
                                    <span class="ml-2" t-esc="product.name"/>
                                </div>
                                <div class="mb-3">
                                    <strong>Loại thuốc:</strong>
                                    <span class="ml-2" t-esc="product.category or 'N/A'"/>
                                </div>
                                <div class="mb-3">
                                    <strong>Đơn vị tính:</strong>
                                    <span class="ml-2" t-esc="product.uom_id"/>
                                </div>
                                <div class="mb-3">
                                    <strong>Nhà sản xuất:</strong>
                                    <span class="ml-2" t-esc="product.manufacturer or 'N/A'"/>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <strong>Giá nhập:</strong>
                                    <span class="ml-2" t-esc="'{:,.0f}'.format(product.purchase_price)"/> VNĐ
                                </div>
                                <div class="mb-3">
                                    <strong>Giá bán:</strong>
                                    <span class="ml-2" t-esc="'{:,.0f}'.format(product.unit_price)"/> VNĐ
                                </div>
                                <div class="mb-3">
                                    <strong>Lợi nhuận:</strong>
                                    <span class="ml-2" t-esc="'{:.2f}'.format(product.profit_margin)"/>%
                                </div>
                                <div class="mb-3">
                                    <strong>Số lượng tồn kho:</strong>
                                    <span t-att-class="'ml-2 ' + ('text-danger font-weight-bold' if product.is_quantity else '')" t-esc="product.quantity"/>
                                    <t t-if="product.is_quantity">
                                        <i class="fa fa-exclamation-triangle text-warning ml-1" title="Sắp hết hàng"></i>
                                    </t>
                                </div>
                                <div class="mb-3">
                                    <strong>Được bảo hiểm chi trả:</strong>
                                    <span class="ml-2" t-if="product.insurance_covered">
                                        <i class="fa fa-check-circle text-success"></i> Có
                                    </span>
                                    <span class="ml-2" t-if="not product.insurance_covered">
                                        <i class="fa fa-times-circle text-danger"></i> Không
                                    </span>
                                </div>
                            </div>
                        </div>

                        <div class="mt-4">
                            <h5>Thông tin thêm</h5>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <strong>Ngày sản xuất:</strong>
                                        <span class="ml-2" t-esc="product.date or 'N/A'"/>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <strong>Hạn sử dụng:</strong>
                                        <span class="ml-2" t-esc="product.expiry or 'N/A'"/>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="mt-4">
                            <h5>Mô tả</h5>
                            <div class="border p-3 bg-light">
                                <t t-if="product.description">
                                    <p t-esc="product.description"/>
                                </t>
                                <t t-else="">
                                    <p class="text-muted">Không có mô tả.</p>
                                </t>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </t>
    </template>
</odoo>