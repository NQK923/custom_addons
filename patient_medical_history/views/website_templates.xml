<odoo>
    <!-- Template hiển thị lịch sử khám bệnh -->
    <template id="patient_medical_history_website" name="Lịch sử khám bệnh">
        <t t-call="website.layout">
            <div class="container mt-5">
                <!-- Khu vực nhập mã bệnh nhân -->
                <div class="row justify-content-center">
                    <div class="col-md-6">
                        <h2 class="text-center mb-4">Xem lịch sử khám bệnh</h2>
                        <form action="/medical/history" method="get" class="mb-5">
                            <div class="form-group">
                                <label for="patient_identifier">Nhập mã bệnh nhân (ID hoặc Tên)</label>
                                <input type="text" name="patient_identifier" id="patient_identifier" class="form-control" placeholder="Nhập ID hoặc Tên bệnh nhân" required="1"/>
                            </div>
                            <div class="text-center">
                                <button type="submit" class="btn btn-primary">Xem lịch sử</button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Hiển thị thông báo nếu có lỗi -->
                <t t-if="error">
                    <div class="alert alert-warning text-center">
                        <t t-esc="error"/>
                    </div>
                </t>

                <!-- Hiển thị thông tin bệnh nhân và lịch sử nếu có -->
                <t t-if="history">
                    <h3 class="mb-4">Lịch sử khám bệnh của: <t t-esc="history.patient_id.name"/></h3>

                    <!-- Thông tin bệnh nhân -->
                    <div class="card mb-5">
                        <div class="card-header">
                            <h4 class="mb-0">Thông tin bệnh nhân</h4>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <p><strong>Mã bệnh nhân:</strong> <t t-esc="history.patient_id.code"/></p>
                                    <p><strong>Họ và tên:</strong> <t t-esc="history.patient_id.name"/></p>
                                    <p><strong>Ngày sinh:</strong> <t t-esc="history.patient_id.date_of_birth"/></p>
                                    <p><strong>Tuổi:</strong> <t t-esc="history.patient_id.age"/></p>
                                    <p><strong>Giới tính:</strong> <t t-esc="dict(history.patient_id._fields['gender'].selection).get(history.patient_id.gender)"/></p>
                                    <p><strong>Số điện thoại:</strong> <t t-esc="history.patient_id.phone"/></p>
                                </div>
                                <div class="col-md-6">
                                    <p><strong>Email:</strong> <t t-esc="history.patient_id.email"/></p>
                                    <p><strong>Loại bệnh nhân:</strong> <t t-esc="dict(history.patient_id._fields['patient_type'].selection).get(history.patient_id.patient_type)"/></p>
                                    <p><strong>Ngày đăng ký:</strong> <t t-esc="history.patient_id.date"/></p>
                                    <p><strong>Ghi chú:</strong> <t t-esc="history.patient_id.note"/></p>
                                </div>
                            </div>
                            <!-- Thông tin bảo hiểm -->
                            <h5 class="mt-4">Thông tin bảo hiểm</h5>
                            <t t-if="history.patient_id.has_insurance">
                                <div class="row">
                                    <div class="col-md-6">
                                        <p><strong>Số thẻ BHYT:</strong> <t t-esc="history.patient_id.insurance_number"/></p>
                                        <p><strong>Nơi ĐKKCB:</strong> <t t-esc="history.patient_id.insurance_facility"/></p>
                                        <p><strong>Có giá trị đến:</strong> <t t-esc="history.patient_id.insurance_expiry"/></p>
                                    </div>
                                    <div class="col-md-6">
                                        <p><strong>Tuyến:</strong> <t t-esc="dict(history.patient_id._fields['insurance_tier'].selection).get(history.patient_id.insurance_tier)"/></p>
                                        <p><strong>Trạng thái:</strong> <t t-esc="history.patient_id.insurance_state"/></p>
                                    </div>
                                </div>
                            </t>
                            <t t-else="">
                                <p>Không có thông tin bảo hiểm.</p>
                            </t>
                        </div>
                    </div>

                    <!-- Xét nghiệm -->
                    <h4>Xét nghiệm</h4>
                    <table class="table table-striped mb-5">
                        <thead>
                            <tr>
                                <th>Mã xét nghiệm</th>
                                <th>Loại</th>
                                <th>Ngày thực hiện</th>
                                <th>Trạng thái</th>
                                <th>Kết quả</th>
                            </tr>
                        </thead>
                        <tbody>
                            <t t-foreach="history.medical_tests" t-as="test">
                                <tr>
                                    <td><t t-esc="test.test_code"/></td>
                                    <td><t t-esc="test.test_type"/></td>
                                    <td><t t-esc="test.test_date"/></td>
                                    <td><t t-esc="test.status"/></td>
                                    <td><t t-esc="test.result"/></td>
                                </tr>
                            </t>
                            <t t-if="not history.medical_tests">
                                <tr>
                                    <td colspan="5" class="text-center">Không có dữ liệu xét nghiệm.</td>
                                </tr>
                            </t>
                        </tbody>
                    </table>

                    <!-- Hình ảnh y tế -->
                    <h4>Hình ảnh y tế</h4>
                    <table class="table table-striped mb-5">
                        <thead>
                            <tr>
                                <th>Mã hình ảnh</th>
                                <th>Xét nghiệm liên quan</th>
                                <th>Loại</th>
                                <th>Ngày chụp</th>
                                <th>Hình ảnh</th>
                            </tr>
                        </thead>
                        <tbody>
                            <t t-foreach="history.medical_images" t-as="image">
                                <tr>
                                    <td><t t-esc="image.test_code"/></td>
                                    <td><t t-esc="image.MedicalTest_id.test_code"/></td>
                                    <td><t t-esc="image.test_type_img"/></td>
                                    <td><t t-esc="image.img_date"/></td>
                                    <td>
                                        <img t-att-src="'data:image/png;base64,' + image.Img.decode('utf-8') if image.Img else ''" style="max-width: 100px;"/>
                                    </td>
                                </tr>
                            </t>
                            <t t-if="not history.medical_images">
                                <tr>
                                    <td colspan="5" class="text-center">Không có dữ liệu hình ảnh y tế.</td>
                                </tr>
                            </t>
                        </tbody>
                    </table>

                    <!-- Kế hoạch điều trị -->
                    <h4>Kế hoạch điều trị</h4>
                    <table class="table table-striped mb-5">
                        <thead>
                            <tr>
                                <th>Mã kế hoạch</th>
                                <th>Ngày bắt đầu</th>
                                <th>Ngày kết thúc</th>
                            </tr>
                        </thead>
                        <tbody>
                            <t t-foreach="history.treatment_plans" t-as="plan">
                                <tr>
                                    <td><t t-esc="plan.name"/></td>
                                    <td><t t-esc="plan.start_date"/></td>
                                    <td><t t-esc="plan.end_date"/></td>
                                </tr>
                            </t>
                            <t t-if="not history.treatment_plans">
                                <tr>
                                    <td colspan="3" class="text-center">Không có dữ liệu kế hoạch điều trị.</td>
                                </tr>
                            </t>
                        </tbody>
                    </table>

                    <!-- Quá trình điều trị -->
                    <h4>Quá trình điều trị</h4>
                    <table class="table table-striped mb-5">
                        <thead>
                            <tr>
                                <th>Mã quá trình</th>
                                <th>Dịch vụ</th>
                                <th>Người thực hiện</th>
                                <th>Trạng thái</th>
                                <th>Thời gian</th>
                            </tr>
                        </thead>
                        <tbody>
                            <t t-foreach="history.treatment_processes" t-as="process">
                                <tr>
                                    <td><t t-esc="process.code"/></td>
                                    <td><t t-esc="process.service_id.name"/></td>
                                    <td><t t-esc="process.executor_id.name"/></td>
                                    <td><t t-esc="process.state"/></td>
                                    <td><t t-esc="process.execution_time"/></td>
                                </tr>
                            </t>
                            <t t-if="not history.treatment_processes">
                                <tr>
                                    <td colspan="5" class="text-center">Không có dữ liệu quá trình điều trị.</td>
                                </tr>
                            </t>
                        </tbody>
                    </table>

                    <!-- Theo dõi chăm sóc -->
                    <h4>Theo dõi chăm sóc</h4>
                    <table class="table table-striped mb-5">
                        <thead>
                            <tr>
                                <th>Ngày chăm sóc</th>
                                <th>Nhân viên</th>
                                <th>Trạng thái</th>
                                <th>Nhiệt độ</th>
                                <th>Huyết áp</th>
                                <th>Nhịp tim</th>
                            </tr>
                        </thead>
                        <tbody>
                            <t t-foreach="history.care_trackings" t-as="care">
                                <tr>
                                    <td><t t-esc="care.care_date"/></td>
                                    <td><t t-esc="care.doctor_id.name"/></td>
                                    <td><t t-esc="care.statenew"/></td>
                                    <td><t t-esc="care.temperature"/></td>
                                    <td><t t-esc="care.blood_pressure"/></td>
                                    <td><t t-esc="care.heart_rate"/></td>
                                </tr>
                            </t>
                            <t t-if="not history.care_trackings">
                                <tr>
                                    <td colspan="6" class="text-center">Không có dữ liệu theo dõi chăm sóc.</td>
                                </tr>
                            </t>
                        </tbody>
                    </table>
                </t>
            </div>

            <!-- Footer -->
            <footer class="bg-dark text-white py-4 mt-5">
                <div class="container">
                    <div class="row">
                        <div class="col-md-4">
                            <h5>USEFUL LINKS</h5>
                            <ul class="list-unstyled">
                                <li><a href="#" class="text-white">Home</a></li>
                                <li><a href="#" class="text-white">About us</a></li>
                                <li><a href="#" class="text-white">Products</a></li>
                            </ul>
                        </div>
                        <div class="col-md-4">
                            <h5>About us</h5>
                            <p>We are a team of passionate people whose goal is to improve everyone's life through disruptive products. We build great products to solve your business problems.</p>
                        </div>
                        <div class="col-md-4">
                            <h5>Connect with us</h5>
                            <ul class="list-unstyled">
                                <li><a href="#" class="text-white">Contact us</a></li>
                                <li><a href="mailto:info@yourcompany.example.com" class="text-white">info@yourcompany.example.com</a></li>
                                <li><a href="tel:+1555-555-5556" class="text-white">+1 555-555-5556</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </footer>

            <!-- CSS tùy chỉnh -->
            <style>
                .btn-primary {
                    background-color: #6d4c41;
                    border-color: #6d4c41;
                }
                .btn-primary:hover {
                    background-color: #5a3e36;
                    border-color: #5a3e36;
                }
                h2, h3, h4, h5 {
                    color: #333;
                }
                .table thead th {
                    background-color: #f8f9fa;
                }
                .card {
                    border: 1px solid #ddd;
                    border-radius: 5px;
                }
                .card-header {
                    background-color: #f8f9fa;
                }
            </style>
        </t>
    </template>

    <!-- Menu website -->
    <record id="website_menu_medical_history" model="website.menu">
        <field name="name">Lịch sử khám bệnh</field>
        <field name="url">/medical/history</field>
        <field name="parent_id" ref="website.main_menu"/>
        <field name="sequence" type="int">50</field>
    </record>
</odoo>